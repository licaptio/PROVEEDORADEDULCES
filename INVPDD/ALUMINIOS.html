<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>üì¶ Aluminios y Encerados | PROVSOFT</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <!-- ===== BLOQUE 1: ESTILOS ===== -->
  <style>
    body {
      font-family: Poppins, Arial, sans-serif;
      background: #f6f8fb;
      color: #222;
      padding: 20px;
    }

    h2 {
      text-align: center;
      color: #003366;
      margin-bottom: 15px;
    }

    table {
      width: 100%;
      border-collapse: collapse;
      background: white;
      border-radius: 10px;
      overflow: hidden;
      box-shadow: 0 2px 6px rgba(0,0,0,0.1);
    }

    th, td {
      padding: 10px;
      text-align: center;
      border-bottom: 1px solid #ddd;
    }

    th {
      background: #003366;
      color: white;
      font-weight: 500;
    }

    tr:hover { background: #f0f6ff; }

    input[type="number"] {
      width: 70px;
      padding: 5px;
      font-size: 14px;
      text-align: center;
      border: 1px solid #ccc;
      border-radius: 4px;
    }

    button {
      border: none;
      background: #003366;
      color: white;
      padding: 4px 8px;
      border-radius: 4px;
      cursor: pointer;
      font-weight: bold;
    }

    button:hover { background: #0059b3; }

    @media (max-width: 768px) {
      input[type="number"] { width: 60px; font-size: 13px; }
      td, th { font-size: 12px; padding: 8px; }
    }
  /* === Bot√≥n de borrar === */
#btnBorrar {
  display: block;
  margin: 20px auto;
  background: #b30000;
  color: #fff;
  border: none;
  padding: 8px 16px;
  border-radius: 6px;
  font-weight: bold;
  cursor: pointer;
  transition: 0.2s;
}
#btnBorrar:hover {
  background: #e60000;
}
/* === Bot√≥n de enviar a Telegram === */
#btnEnviar {
  display: block;
  margin: 10px auto 30px auto;
  background: #0088cc;
  color: #fff;
  border: none;
  padding: 8px 16px;
  border-radius: 6px;
  font-weight: bold;
  cursor: pointer;
  transition: 0.2s;
}
#btnEnviar:hover {
  background: #00aaff;
}
/* === Bot√≥n Ver Pedidos === */
#btnVerPedidos {
  display: block;
  margin: 10px auto;
  background: #ffaa00;
  color: #000;
  border: none;
  padding: 8px 16px;
  border-radius: 6px;
  font-weight: bold;
  cursor: pointer;
  transition: 0.2s;
}
#btnVerPedidos:hover { background: #ffcc33; }

/* === Ventana Modal === */
#ventanaPedidos {
  display: none;
  position: fixed;
  top: 0; left: 0;
  width: 100%; height: 100%;
  background: rgba(0,0,0,0.5);
  z-index: 999;
  justify-content: center;
  align-items: center;
}
#contenidoPedidos {
  background: white;
  border-radius: 10px;
  padding: 20px;
  width: 90%;
  max-width: 600px;
  max-height: 80%;
  overflow-y: auto;
  box-shadow: 0 0 10px rgba(0,0,0,0.3);
}
#contenidoPedidos h3 {
  margin-top: 0;
  text-align: center;
  color: #003366;
}
#cerrarPedidos {
  display: block;
  margin: 10px auto;
  background: #b30000;
  color: white;
  border: none;
  padding: 6px 12px;
  border-radius: 6px;
  cursor: pointer;
}
#listaPedidos div {
  background: #f8faff;
  border: 1px solid #d3e0f0;
  border-radius: 6px;
  padding: 6px 10px;
  margin-bottom: 6px;
}

  </style>
</head>
<body>
  <h2 id="tituloCategoria"></h2>

  <table id="tablaInventario">
    <thead>
      <tr>
        <th>Producto</th>
        <th>Inventario manual</th>
        <th>Stock</th>
        <th>Pedido</th>
        <th>Inventario acumulado</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>
 
  <!-- üîò BOT√ìN PARA BORRAR INFORMACI√ìN -->
<button id="btnBorrar">üßπ Borrar informaci√≥n</button>
<!-- üì§ BOT√ìN PARA ENVIAR INVENTARIO A TELEGRAM -->
<button id="btnEnviar">üì§ Enviar inventario a Telegram</button>
<!-- üßæ BOT√ìN PARA MOSTRAR PEDIDOS -->
<button id="btnVerPedidos">üßæ Ver pedidos actuales</button>



  <!-- ===== BLOQUE 2: DATOS ===== -->
  <script>
    const categoria = {
      nombre: "üì¶ Aluminios y Encerados",
      items: [
        ["ALUMINIO 5 MTS BONALUM","",30,""],
        ["ALUMINIO 7 MTS BONALUM","",30,""],
        ["ALUMINIO 10 MTS BONALUM","",20,""],
        ["ALUMINIO 50 MTS CARO BONALUM","",10,""],
        ["STAR FOIL 500GR C/12 BONALUM","",2,""],
        ["ALUMINIO 3 KG C/4PZ BONALUM","",2,""],
        ["PAPEL PARA ESTUFA","",50,""],
        ["ALUMINIO 5 MTS ALUMSTAR","",20,""],
        ["ALUMINIO 7 MTS ALUMSTAR","",20,""],
        ["ALUMINIO 10 MTS ALUMSTAR","",5,""],
        ["ENCERADO 10 MTS","",5,""],
        ["ENCERADO 20 MTS","",5,""],
        ["ROLLO ENCERADO 3 KG","",2,""]
      ]
    };
  </script>

  <!-- ===== BLOQUE 3: GENERACI√ìN AUTOM√ÅTICA DE FILAS ===== -->
  <script>
    document.addEventListener("DOMContentLoaded", () => {
      const tbody = document.querySelector("#tablaInventario tbody");
      document.querySelector("#tituloCategoria").textContent = categoria.nombre;

      categoria.items.forEach((item, index) => {
        const fila = document.createElement("tr");
        fila.innerHTML = `
          <td>${item[0]}</td>
          <td><input type="number" inputmode="numeric" value="${item[1]}"></td>
          <td>${item[2]}</td>
          <td><input type="number" inputmode="numeric" value="${item[3]}"></td>
          <td>
            <button class="menos">‚àí</button>
            <span class="valor">0</span>
            <button class="mas">+</button>
          </td>
        `;
        tbody.appendChild(fila);
      });

      inicializarBotones();
      configurarBorrado();
      configurarEnvioTelegram();
      configurarVerPedidos(); // üëà agrega esta l√≠nea
    });
  </script>

  <!-- ===== BLOQUE 4: FUNCIONALIDAD MAS / MENOS + GUARDADO LOCAL ===== -->
  <script>
    function inicializarBotones() {
      const filas = document.querySelectorAll("#tablaInventario tbody tr");

      filas.forEach((fila, index) => {
        const valorSpan = fila.querySelector(".valor");
        const menos = fila.querySelector(".menos");
        const mas = fila.querySelector(".mas");

        // Restaurar valor guardado
        const guardado = localStorage.getItem("inv_" + index);
        if (guardado !== null) valorSpan.textContent = guardado;

        mas.addEventListener("click", () => {
          let actual = parseInt(valorSpan.textContent);
          valorSpan.textContent = actual + 1;
          localStorage.setItem("inv_" + index, valorSpan.textContent);
        });

        menos.addEventListener("click", () => {
          let actual = parseInt(valorSpan.textContent);
          if (actual > 0) actual--;
          valorSpan.textContent = actual;
          localStorage.setItem("inv_" + index, valorSpan.textContent);
        });
      });
    }
  </script>
  <!-- ===== BLOQUE: FUNCI√ìN DE BORRADO ===== -->
<script>
function configurarBorrado() {
  document.getElementById("btnBorrar").addEventListener("click", () => {
    if (confirm("¬øSeguro que deseas borrar toda la informaci√≥n temporal?")) {
      const filas = document.querySelectorAll("#tablaInventario tbody tr");
      filas.forEach((_, index) => localStorage.removeItem("inv_" + index));
      document.querySelectorAll(".valor").forEach(v => v.textContent = "0");
      alert("Informaci√≥n borrada correctamente ‚úÖ");
    }
  });
}
</script>

<!-- ===== BLOQUE: ENV√çO A TELEGRAM ===== -->
<!-- ===== BLOQUE: ENV√çO A TELEGRAM (VERSI√ìN SIMPLIFICADA Y EST√âTICA) ===== -->
<script>
function configurarEnvioTelegram() {
  const BOT_TOKEN = "8303572166:AAH0xLN7798A3LROd3CoGkq0RqVogrLhZtw"; // Token de @AlikaINVGRAbot
  const CHAT_ID = "6617988297"; // Chat ID de GERA

  document.getElementById("btnEnviar").addEventListener("click", async () => {
    let mensaje = `üßæ *Inventario capturado ‚Äì PROVSOFT*\n\n`;

    const filas = document.querySelectorAll("#tablaInventario tbody tr");

    filas.forEach(fila => {
      const producto = fila.cells[0].textContent.trim();
      const inventarioManual = parseInt(fila.cells[1].querySelector("input").value || 0);
      const stock = parseInt(fila.cells[2].textContent.trim() || 0);

      // ‚úÖ Si el inventario es cero, lo marca como alerta
      if (inventarioManual === 0) {
        mensaje += `‚ö†Ô∏è *${producto}*\nInventario en CERO ‚ùóÔ∏è | Stock: ${stock}\n\n`;
      } else {
        mensaje += `‚Ä¢ ${producto}\nInventario: ${inventarioManual} | Stock: ${stock}\n\n`;
      }
    });

    try {
      const resp = await fetch(`https://api.telegram.org/bot${BOT_TOKEN}/sendMessage`, {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({
          chat_id: CHAT_ID,
          text: mensaje,
          parse_mode: "Markdown"
        })
      });

      if (resp.ok) {
        alert("‚úÖ Inventario enviado correctamente a Telegram");
      } else {
        alert("‚ùå Error al enviar el inventario. Revisa token o chat ID.");
      }
    } catch (err) {
      console.error(err);
      alert("‚ö†Ô∏è No se pudo conectar con Telegram (ver consola).");
    }
  });
}
</script>

  <!-- ===== BLOQUE 5: NAVEGACI√ìN CON TECLAS ===== -->
  <script>
    document.addEventListener("keydown", (e) => {
      const inputs = Array.from(document.querySelectorAll("input[type='number']"));
      const actual = document.activeElement;
      const idx = inputs.indexOf(actual);

      if (idx >= 0) {
        if (e.key === "ArrowDown" && idx < inputs.length - 1) {
          e.preventDefault();
          inputs[idx + 1].focus();
        } else if (e.key === "ArrowUp" && idx > 0) {
          e.preventDefault();
          inputs[idx - 1].focus();
        }
      }
    });
  </script>
<!-- ===== BLOQUE: MOSTRAR PEDIDOS (SOLO PEDIDO, SIN STOCK) ===== -->
<script>
function configurarVerPedidos() {
  const btn = document.getElementById("btnVerPedidos");
  const modal = document.getElementById("ventanaPedidos");
  const lista = document.getElementById("listaPedidos");
  const cerrar = document.getElementById("cerrarPedidos");

  btn.addEventListener("click", () => {
    lista.innerHTML = ""; // limpiar contenido previo
    let hayPedidos = false;

    const filas = document.querySelectorAll("#tablaInventario tbody tr");

    filas.forEach(fila => {
      const producto = fila.cells[0].textContent.trim();
      const pedido = parseInt(fila.cells[3].querySelector("input").value || 0);

      // solo incluir si pedido > 0
      if (pedido > 0) {
        hayPedidos = true;
        const div = document.createElement("div");
        div.style.marginBottom = "8px";
        div.innerHTML = `üì¶ <b>${producto}</b><br>üõí Pedido: ${pedido}`;
        lista.appendChild(div);
      }
    });

    if (!hayPedidos) {
      lista.innerHTML = `<p style="text-align:center;color:#b30000;font-weight:bold;">‚ö†Ô∏è No hay pedidos registrados.</p>`;
    }

    modal.style.display = "flex";
  });

  cerrar.addEventListener("click", () => modal.style.display = "none");

  // cerrar al hacer clic fuera del contenido
  modal.addEventListener("click", (e) => {
    if (e.target === modal) modal.style.display = "none";
  });
}
</script>


<!-- ===== VENTANA TEMPORAL DE PEDIDOS ===== -->
<div id="ventanaPedidos">
  <div id="contenidoPedidos">
    <h3>üßæ Pedidos actuales</h3>
    <div id="listaPedidos"></div>
    <button id="cerrarPedidos">Cerrar</button>
  </div>
</div>

</body>
</html>
